!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=e()}}(function(){return function l(r,o,u){function s(t,e){if(!o[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var i=o[t]={exports:{}};r[t][0].call(i.exports,function(e){return s(r[t][1][e]||e)},i,i.exports,l,r,o,u)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)s(u[e]);return s}({1:[function(s,e,t){"use strict";var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var A=s("cheerio"),p=s("dasu");s("async.parallellimit");p.follow=!1,p.debug=!1;var V=s("jsonpath"),f="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",h=s("url"),n={};Object.keys(process.env).forEach(function(e){var t=process.env[e];if("0"==t||"false"==t||!t)return n[e]=!1;n[e]=t});var m=n.debug;function z(){m&&console.log.apply(this,arguments)}var a,g=s("querystring"),y=s("human-time"),F={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function i(e,t){if(!t)return new Promise(function(n,a){i(e,function(e,t){if(e)return a(e);n(t)})});var n=void 0;if((n="string"==typeof e?{query:e}:e).userAgent&&(f=n.userAgent),n.search=n.query||n.search,n.original_search=n.search,n.videoId)return function(e,i){z("fn: getVideoMetaData");var t=void 0;"string"==typeof e&&(t=e);"object"===(void 0===e?"undefined":l(e))&&(t=e.videoId);var n="https://www.youtube.com/watch?hl=en&gl=US&v="+t,a=h.parse(n);a.headers={"user-agent":f,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},a.headers["user-agent"]="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",p.req(a,function(e,t,n){if(e)i(e);else{if(200!==t.status)return i("http status: "+t.status);if(m){var a=s("fs");s("path");a.writeFileSync("dasu.response",t.responseText,"utf8")}try{!function(e,t){z("_parseVideoInitialData");var n=e.match(/ytInitialData.*=\s*({.*});/);if(!n[1])return t("could not find inital data in the html document");var a=e.match(/ytInitialPlayerResponse.*=\s*({.*});/);if(!a[1])return t("could not find inital player data in the html document");var i=JSON.parse(n[1]),l=JSON.parse(a[1]),r=V.value(i,"$..currentVideoEndpoint..videoId");if(!r)return t("video unavailable");if("ERROR"===V.value(l,"$..status")||"Video unavailable"===V.value(l,"$..reason"))return t("video unavailable");var o=V.value(i,"$..videoPrimaryInfoRenderer..title..text")||V.value(i,"$..videoPrimaryInfoRenderer..title..simpleText")||V.value(i,"$..videoPrimaryRenderer..title..text")||V.value(i,"$..videoPrimaryRenderer..title..simpleText")||V.value(i,"$..title..text")||V.value(i,"$..title..simpleText"),u=V.value(l,"$..description..text")||V.value(l,"$..description..simpleText")||V.value(i,"$..description..text")||V.value(i,"$..description..simpleText"),s=V.value(i,"$..owner..title..text")||V.value(i,"$..owner..title..simpleText"),c=V.value(i,"$..owner..navigationEndpoint..url")||V.value(i,"$..owner..title..url"),d="https://i.ytimg.com/vi/"+r+"/hqdefault.jpg",v=K(w(1e3*Number(V.value(l,"$..videoDetails..lengthSeconds")))),p=V.value(i,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),f=(Number(p[0]),Number(p[1]),V.value(i,"$..dateText")),h={title:o,description:u,url:F.YT+"/watch?v="+r,videoId:r,seconds:Number(v.seconds),timestamp:v.timestamp,duration:v,views:Number(V.value(l,"$..videoDetails..viewCount")),genre:(V.value(l,"$..category")||"").toLowerCase(),uploadDate:V.value(l,"$..uploadDate"),ago:y(new Date(f)),image:d,thumbnail:d,author:{name:s,url:F.YT+c}};t(null,h)}(n,i)}catch(e){i(e)}}})}(n.videoId,t);if(n.listId)return function(e,i){z("fn: getPlaylistMetaData");var t=void 0;"string"==typeof e&&(t=e);"object"===(void 0===e?"undefined":l(e))&&(t=e.listId||e.playlistId);var n="https://www.youtube.com/playlist?hl=en&gl=US&list="+t,a=h.parse(n);a.headers={"user-agent":f,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},p.req(a,function(e,t,n){if(e)i(e);else{if(200!==t.status)return i("http status: "+t.status);if(m){var a=s("fs");s("path");a.writeFileSync("dasu.response",t.responseText,"utf8")}try{!function(e,t){z("fn: parsePlaylistBody");var n=e.match(/ytInitialData.*=\s*({.*});/)[1];if(!n)throw new Error("failed to parse ytInitialData json data");var a=JSON.parse(n),i=V.value(a,"$..microformat..urlCanonical").split("=")[1],l=V.value(a,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/),r=V.query(a,"$..contents..tabs[0]..contents[0]..contents[0]..contents")[0],o=[];r.forEach(function(e){var t=e,n={title:V.value(t,"$..title..simpleText"),videoId:V.value(t,"$..videoId"),listId:i,thumbnail:V.value(t,"$..thumbnail..thumbnails[0]..url").split("?")[0],author:{name:V.value(t,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+V.value(t,"$..shortBylineText..runs[0]..url")}};o.push(n)});var u={title:V.value(a,"$..microformat..title"),listId:i,url:"https://youtube.com/playlist?list="+i,views:Number(l),date:c(V.value(a,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")),image:o[0].thumbnail,thumbnail:o[0].thumbnail,videos:o,author:{name:V.value(a,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+V.value(a,"$..videoOwner..navigationEndpoint..url")}};t&&t(null,u)}(n,i)}catch(e){i(e)}}})}(n.listId,t);if(!n.search)return t(Error("yt-search: no query given"));!function c(d,v){var e=g.escape(d.search).split(/\s+/),t=d.hl||"en",n=d.gl||"US",a=d.category||"",i=Number(d.pageStart)||1,l=Number(d.pageEnd)||Number(d.pages)||1;i<=0&&(i=1)<=l&&(l+=1),Number.isNaN(l)&&v("error: pageEnd must be a number"),d.pageStart=i,d.pageEnd=l,d.currentPage=d.currentPage||i;var r="?";-1===(r+="search_query="+e.join("+")).indexOf("&hl=")&&(r+="&hl="+t),-1===r.indexOf("&gl=")&&(r+="&gl="+n),a&&(r+="&category="+a),d.sp&&(r+="&sp="+d.sp);var o=F.SEARCH_DESKTOP+r,u=h.parse(o);u.headers={"user-agent":f,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},z(u),z("getting results: "+d.currentPage),p.req(u,function(e,t,n){if(e)v(e);else{if(200!==t.status)return v("http status: "+t.status);if(m){var a=s("fs");s("path"),a.writeFileSync("dasu.response",t.responseText,"utf8")}try{T(n,function(e,t){if(e)return v(e);var n=t,a=n.filter(x),i=n.filter($),l=n.filter(b);d._data=d._data||{},d._data.videos=d._data.videos||[],d._data.playlists=d._data.playlists||[],d._data.channels=d._data.channels||[],a.forEach(function(e){d._data.videos.push(e)}),i.forEach(function(e){d._data.playlists.push(e)}),l.forEach(function(e){d._data.channels.push(e)}),d.currentPage++;var r=d.currentPage<=d.pageEnd;if(r&&t._sp)d.sp=t._sp,setTimeout(function(){c(d,v)},2500);else{var o=d._data.videos.filter(x),u=d._data.playlists.filter($),s=d._data.channels.filter(b);v(null,{videos:o,playlists:u,lists:u,accounts:s,channels:s})}})}catch(e){v(e)}}})}(n,t)}function x(e,t,n){if("video"!==e.type)return!1;var a=e.videoId;return n.findIndex(function(e){return a===e.videoId})===t}function $(e,t,n){if("list"!==e.type)return!1;var a=e.listId;return n.findIndex(function(e){return a===e.listId})===t}function b(e,t,n){if("channel"!==e.type)return!1;var a=e.url;return n.findIndex(function(e){return a===e.url})===t}function H(e){var t=void 0;return"string"!=typeof e?e.length?H(t=e[0]):void 0:0===(t=(t=(t=(t=e).split("?")[0]).split("/default.jpg").join("/hqdefault.jpg")).split("/default.jpeg").join("/hqdefault.jpeg")).indexOf("//")?"https://"+t.slice(2):t.split("http://").join("https://")}function J(e){var t=e.split(/\s+/).filter(function(e){return e.match(/\d/)})[0].toLowerCase(),n=Number(t.replace(/\D/g,""));return 0<=t.indexOf("m")?1e6*n:0<=t.indexOf("k")?1e3*n:n}function T(e,t){var a=/{.*}/,n=A.load(e),i=n("div#initial-data").html()||"";if(!(i=a.exec(i)||""))for(var l=n("script"),r=0;r<l.length;r++){n(l[r]).html().split("\n").forEach(function(e){for(var t=void 0;0<=(t=e.indexOf("ytInitialData"));){e=e.slice(t+"ytInitialData".length);var n=a.exec(e);n&&n.length>i.length&&(i=n)}})}if(!i)return t("could not find inital data in the html document");var o=[],u=[],s=JSON.parse(i[0]),c=V.query(s,"$..itemSectionRenderer..contents.*");z("items.length: "+c.length);for(var d=0;d<c.length;d++){var v=c[d],p=void 0,f="unknown",h=v.compactPlaylistRenderer||v.playlistRenderer,m=v.compactChannelRenderer||v.channelRenderer,g=v.compactVideoRenderer||v.videoRenderer,y=h&&V.value(v,"$..playlistId"),x=m&&V.value(v,"$..channelId"),$=g&&V.value(v,"$..videoId");$&&(f="video"),x&&(f="channel"),y&&(f="list");try{switch(f){case"video":var b=H(V.value(v,"$..thumbnail..url"))||H(V.value(v,"$..thumbnails..url"))||H(V.value(v,"$..thumbnails")),T=V.value(v,"$..title..text")||V.value(v,"$..title..simpleText"),w=V.value(v,"$..shortBylineText..text")||V.value(v,"$..longBylineText..text"),I=V.value(v,"$..shortBylineText..url")||V.value(v,"$..longBylineText..url"),S=V.value(v,"$..publishedTimeText..text")||V.value(v,"$..publishedTimeText..simpleText"),_=V.value(v,"$..viewCountText..text")||V.value(v,"$..viewCountText..simpleText"),D=Number(_.split(/\s+/)[0].split(/[,.]/).join("").trim()),E=K(V.value(v,"$..lengthText..text")||V.value(v,"$..lengthText..simpleText")||"0:00"),N=V.value(v,"$..description..text")||V.value(v,"$..descriptionSnippet..text");p={type:"video",videoId:$,url:F.YT+"/watch?v="+$,title:T.trim(),description:N,image:b,thumbnail:b,seconds:Number(E.seconds),timestamp:E.timestamp,duration:E,ago:S,views:Number(D),author:{name:w,url:F.YT+I}};break;case"list":var C=H(V.value(v,"$..thumbnail..url"))||H(V.value(v,"$..thumbnails..url"))||H(V.value(v,"$..thumbnails")),j=V.value(v,"$..title..text")||V.value(v,"$..title..simpleText"),O=V.value(v,"$..shortBylineText..text")||V.value(v,"$..longBylineText..text")||V.value(v,"$..shortBylineText..simpleText")||V.value(v,"$..longBylineText..simpleTextn")||"YouTube",R=V.value(v,"$..shortBylineText..url")||V.value(v,"$..longBylineText..url")||"",q=V.value(v,"$..videoCountShortText..text")||V.value(v,"$..videoCountText..text")||V.value(v,"$..videoCountShortText..simpleText")||V.value(v,"$..videoCountText..simpleText")||V.value(v,"$..thumbnailText..text")||V.value(v,"$..thumbnailText..simpleText");p={type:"list",listId:y,url:F.YT+"/playlist?list="+y,title:j.trim(),image:C,thumbnail:C,videoCount:q,author:{name:O,url:F.YT+R}};break;case"channel":var B=H(V.value(v,"$..thumbnail..url"))||H(V.value(v,"$..thumbnails..url"))||H(V.value(v,"$..thumbnails")),P=V.value(v,"$..title..text")||V.value(v,"$..title..simpleText")||V.value(v,"$..displayName..text"),M=V.value(v,"$..shortBylineText..text")||V.value(v,"$..longBylineText..text")||V.value(v,"$..displayName..text")||V.value(v,"$..displayName..simpleText"),k=V.value(v,"$..videoCountText..text")||V.value(v,"$..videoCountText..simpleText"),Y=V.value(v,"$..subscriberCountText..text")||V.value(v,"$..subscriberCountText..simpleText");"string"==typeof Y&&(Y=Y.split(/\s+/).filter(function(e){return e.match(/\d/)})[0]);var U=V.value(v,"$..navigationEndpoint..url")||"/user/"+P;p={type:"channel",name:M,url:F.YT+U,title:P.trim(),image:B,thumbnail:B,videoCount:Number(k.replace(/\D+/g,"")),videoCountLabel:k,subCount:J(Y),subCountLabel:Y}}p&&u.push(p)}catch(e){z(e),o.push(e)}}var L=V.value(s,"$..continuation");return u._ctoken=L,o.length?t(o.pop(),u):t(null,u)}function K(e){var t=e.split(/\s+/),n=t[t.length-1].replace(/[^:.\d]/g,"");if(!n)return{toString:function(){return t[0]},seconds:0,timestamp:0};for(;n[n.length-1].match(/\D/);)n=n.slice(0,-1);for(var a=(n=n.replace(/\./g,":")).split(/[:.]/),i=0,l=0,r=a.length-1;0<=r;r--)if(!(a[r].length<=0)){var o=a[r].replace(/\D/g,"");if(i+=parseInt(o)*(0<l?Math.pow(60,l):1),2<++l)break}return{toString:function(){return i+" seconds ("+n+")"},seconds:i,timestamp:n}}function w(e){var t="",n=Math.floor(e/36e5),a=Math.floor(e/6e4)%60,i=Math.floor(e/1e3)%60;return n&&(t+=n+":"),a&&(t+=a+":"),String(i).length<2&&(t+="0"),t+=i}function c(e){z("fn: _parsePlaylistLastUpdateTime");for(var t=e.trim().split(/[\s.-]+/),n=0;n<t.length;n++){var a=t.slice(n),i=a.join(" "),l=a.reverse().join(" "),r=new Date(i),o=new Date(l);if("Invalid Date"!==r.toString())return u(r);if("Invalid Date"!==o.toString())return u(o)}return""}function u(e){return z("fn: _toInternalDateString"),e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()}e.exports=function(e,t){return i(e,t)},e.exports.search=i,s.main===e&&(a="superman theme list pewdiepie channel",console.log("test: doing list search"),i({query:a,pageEnd:1},function(e,t){if(e)throw e;var n=t.videos,a=t.playlists,i=t.channels;console.log("videos: "+n.length),console.log("playlists: "+a.length),console.log("channels: "+i.length);for(var l=0;l<n.length;l++){var r=n[l],o=" ("+r.timestamp+")";console.log(r.title+o)}a.forEach(function(e){console.log("playlist: "+e.title+" | "+e.listId)}),i.forEach(function(e){console.log("channel: "+e.title+" | "+e.description)})}))},{"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}]},{},[1])(1)});